---
title: Weird bug using Webpack + OfflinePlugin
date: "2020-02-07T23:35:00.000Z"
description: "My odyssey trying solutions for a cache-related bug. Here is the winner."
---

There is a two-factor combination that makes a bug really annoying: Not replicable and only happens in production ğŸ’€

I was in this situation for almost two months ğŸ˜µ There was a bug in our web app that used to happen only sometimes. The causes and the steps to reproduce it were not clear. It just happened in any section of the app at random times ğŸ”€ The only thing we could do was to try a different potential solution every time we were going to deploy a new version and hope it'd work ğŸ™ So frustrating ğŸ¤¦â€â™€ï¸

âŒ The error message the console showed was:
```javascript
Uncaught (in promise) Error: Loading chunk # failed
```
This error launches the blank screen we see in the browser when Javascript code crashes ğŸ’¥ Or a custom error page if you are more user-friendly ğŸ’Ÿ

The issue here was relatively obvious ğŸ¤” With a basic google search, we noticed there was desynchronization between cache references and compiled files generated by webpack ğŸ” As a result, when new features were deployed,the cache was not always synchronized on time with the new set of chunk names ğŸ”„This lack of sync would cause a not found referenced chunk âŒ

Then the problem was clarified, but the solution was not ğŸ§ There was a long list of possible solutions, but only one would be the winner according to the project configuration and needs ğŸ†

â¡ï¸ These are a couple of things we tried before finding our winner:

- Change the cache strategy.
- Load OfflinePlugin at the end.
- If Lazy load fails, retry.
- If Lazy load fails, reload. <small>It worked sometimes, but it's not a good idea ğŸ¤­</small>
- Do not cache some files.
- Play with different OfflinePlugin configs.

ğŸ’¡ What worked: Change webpack configuration. Specifically, enable the [recordsPath][records-path] option âœ”ï¸

This option enables a different way to track chunks, using a file to manage the references to them instead of using their names ğŸ“ Perfect to avoid cache issues like this one ğŸ‘Œ

It sounds pretty simple at the end, huh? ğŸ¤“
Well, this is a product of a lot of research and learning. I hope this saves me some time in the future and help others to do the same âœŒï¸


[records-path]: https://webpack.js.org/configuration/other-options/#recordspath