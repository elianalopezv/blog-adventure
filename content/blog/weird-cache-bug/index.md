---
title: Weird bug using Webpack + OfflinePlugin
date: "2020-02-07T23:35:00.000Z"
description: "My odyssey trying solutions for a cache-related bug. Here is the winner."
---

There is a two-factor combination that makes a bug really annoying: Not replicable and only happens in production 💀

I was in this situation for almost two months 😵 There was a bug in our web app that used to happen only sometimes. The causes and the steps to reproduce it were not clear. It just happened in any section of the app at random times 🔀 The only thing we could do was to try a different potential solution every time we were going to deploy a new version and hope it'd work 🙏 So frustrating 🤦‍♀️

❌ The error message the console showed was:
```javascript
Uncaught (in promise) Error: Loading chunk # failed
```
This error launches the blank screen we see in the browser when Javascript code crashes 💥 Or a custom error page if you are more user-friendly 💟

The issue here was relatively obvious 🤔 With a basic google search, we noticed there was desynchronization between cache references and compiled files generated by webpack 🔎 As a result, when new features were deployed,the cache was not always synchronized on time with the new set of chunk names 🔄This lack of sync would cause a not found referenced chunk ❌

Then the problem was clarified, but the solution was not 🧐 There was a long list of possible solutions, but only one would be the winner according to the project configuration and needs 🏆

➡️ These are a couple of things we tried before finding our winner:

- Change the cache strategy.
- Load OfflinePlugin at the end.
- If Lazy load fails, retry.
- If Lazy load fails, reload. <small>It worked sometimes, but it's not a good idea 🤭</small>
- Do not cache some files.
- Play with different OfflinePlugin configs.

💡 What worked: Change webpack configuration. Specifically, enable the [recordsPath][records-path] option ✔️

This option enables a different way to track chunks, using a file to manage the references to them instead of using their names 📝 Perfect to avoid cache issues like this one 👌

It sounds pretty simple at the end, huh? 🤓
Well, this is a product of a lot of research and learning. I hope this saves me some time in the future and help others to do the same ✌️


[records-path]: https://webpack.js.org/configuration/other-options/#recordspath